<script lang="ts">
	import { onMount } from 'svelte';
	import {
		prepareUpdate,
		handleSaveGreeting,
		handleDeleteGreeting,
		loadGreetings,
		initSocketListeners
	} from '$api/services/greetingsService';
	import { greetingsStore } from '$stores/greetingsStore';

	let name: string = '';
	let message: string = '';
	let editingId: string | null = null;

	onMount(() => {
		loadGreetings();
		const cleanup = initSocketListeners();
		return cleanup;
	});
</script>

<form on:submit|preventDefault={handleSaveGreeting}>
	<label for="nameInput">
		Nom :
		<input id="nameInput" name="name" type="text" autocomplete="name" bind:value={name} />
	</label>

	<label for="messageInput">
		Message :
		<input id="messageInput" name="message" type="text" autocomplete="on" bind:value={message} />
	</label>
	<button type="submit">Envoyer</button>
</form>

{#each $greetingsStore as greeting}
	<li>
		{greeting.name}: {greeting.message}
		<button on:click={() => prepareUpdate(greeting)}>Modifier</button>
		<button
			on:click={() => handleDeleteGreeting(greeting._id)}
			disabled={editingId === greeting._id}
		>
			Supprimer
		</button>
	</li>
{/each}
