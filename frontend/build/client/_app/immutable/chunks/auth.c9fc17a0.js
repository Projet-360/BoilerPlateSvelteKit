import{n as r,a as n}from"./notificationStore.e8f881ab.js";import{j as h}from"./singletons.cb73de64.js";import{w as A}from"./index.d28b6c62.js";import"./index.a9363749.js";const i=h("goto");function E(a,e){switch(a){case"admin":i("/dashboard");break;case"user":i("/user");break;default:i("/")}}const c=A({userId:null,role:null,isAuthenticated:!1}),I=(a,e)=>{let t;switch(console.log(a.message),a.message){case"INVALID_CREDENTIALS":t=e("validation.INVALID_CREDENTIALS");break;case"RATE_LIMIT":t=e("validation.RATE_LIMIT");break;case"EMAIL_NOT_VERIFIED":t=e("validation.EMAIL_NOT_VERIFIED");break;default:t="Une erreur inconnue s'est produite."}r.addNotification(t,"error")},d=(a,e)=>{let t=[];typeof a=="string"?t=a.split(","):a&&a.message?t=a.message.split(","):t=["Une erreur inconnue s'est produite."],t.forEach(o=>{let s;switch(o.trim()){case"EMAIL_EXIST":s=e("validation.EMAIL_EXIST");break;case"USERNAME_REQUIRED":s=e("validation.USERNAME_REQUIRED");break;case"VALID_EMAIL":s=e("validation.VALID_EMAIL");break;case"VALID_USERNAME":s=e("validation.VALID_USERNAME");break;case"NUMBE_CARAC_PASSWORD":s=e("validation.NUMBE_CARAC_PASSWORD");break;case"MIN_PASSWORD":s=e("validation.MIN_PASSWORD");break;case"MAJ_PASSWORD":s=e("validation.MAJ_PASSWORD");break;case"NUMBER_PASSWORD":s=e("validation.NUMBER_PASSWORD");break;case"SPECIAL_CARAC_PASSWORD":s=e("validation.SPECIAL_CARAC_PASSWORD");break;case"RATE_LIMIT":s=e("validation.RATE_LIMIT");break;default:s="Une erreur inconnue s'est produite."}r.addNotification(s,"error")})},f=(a,e)=>{let t;switch(a.message){case"VALID_EMAIL":t=e("validation.VALID_EMAIL");break;case"USER_NOT_FOUND":t=e("validation.USER_NOT_FOUND");break;case"EMAIL_NOT_VERIFIED":t=e("validation.EMAIL_NOT_VERIFIED");break;case"RATE_LIMIT":t=e("validation.RATE_LIMIT");break;default:t="Une erreur inconnue s'est produite."}r.addNotification(t,"error")};async function S(a){try{(await fetch("http://localhost:2000/auth/logout",{method:"GET",credentials:"include"})).ok&&(r.addNotification(a("logout.successLogout"),"success"),c.set({userId:null,role:null,isAuthenticated:!1}),i("/"))}catch{}}let u;c.subscribe(a=>{u=a});async function w(){try{const a=await fetch("http://localhost:2000/auth/check-auth",{credentials:"include"});if(a.ok){const e=await a.json();c.update(t=>({...t,isAuthenticated:e.isAuthenticated,role:e.role,userId:e.userId}))}}catch{}}async function T(a,e,t){try{const o=await n({url:"http://localhost:2000/auth/login",method:"POST",credentials:"include",body:{email:a,password:e}});console.log(o),c.set({role:o.role,isAuthenticated:!0,userId:o.userId});const{role:s,isAuthenticated:l}=u;E(s??"defaultRole",l),r.addNotification(t("validation.SUCCESS_LOGIN"),"success")}catch(o){throw I(o,t),o}}async function D(a,e,t,o){try{(await n({url:"http://localhost:2000/auth/signup",method:"POST",credentials:"include",body:{username:a,email:e,password:t}})).success&&(i("/"),r.addNotification(o("validation.SUCCESS_INSCRIPTION"),"success"))}catch(s){throw d(s,o),s}}async function L(a,e){try{(await fetch(`http://localhost:2000/auth/verify/${a}`)).ok&&(i("/"),r.addNotification(e("validation.EMAIL_VERIFIED"),"success"))}catch{}}async function O(a,e){try{(await n({url:"http://localhost:2000/auth/forgot-password",method:"POST",credentials:"include",body:{email:a}})).success&&(i("/"),r.addNotification(e("validation.EMAIL_FORGOT_PASSWORD"),"success"))}catch(t){throw f(t,e),t}}async function g(a,e,t,o){try{const s=await fetch(`http://localhost:2000/auth/forgot-password/${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:e,confirmPassword:t})});if(s.ok)i("/"),r.addNotification(o("validation.VALIDATION_FORGOT_PASSWORD"),"success");else{const l=await s.json();r.addNotification(o("validation.FORGOT_PASSWORD_INVALID"),"error")}}catch(s){console.log("Caught error:",s),r.addNotification(s.message,"error")}}async function M(){try{const a=new Headers;return await n({url:"http://localhost:2000/auth/user",method:"GET",headers:a,credentials:"include"})}catch(a){throw a}}const y=async(a,e)=>{try{const t=new Headers,o=await n({url:"http://localhost:2000/auth/user/update",method:"PUT",headers:t,credentials:"include",body:a});if(o.success)return r.addNotification(e("validation.UPDATE_SUCCESS"),"success"),o.notification&&(r.addNotification(o.notification,"success"),S(e)),o;throw new Error(e("validation.UPDATE_FAILURE"))}catch(t){throw d(t,e),t}};async function b(){try{const a=new Headers,e=await n({url:"http://localhost:2000/auth/admin/users",method:"GET",headers:a,credentials:"include"});if(e.users)return e.users;throw new Error("Erreur lors de la récupération des utilisateurs")}catch(a){throw a}}async function U(a,e,t){try{const o=new Headers,s=await n({url:`http://localhost:2000/auth/admin/user/${a}`,method:"PUT",headers:o,credentials:"include",body:e});if(s.success)return{success:!0,user:s.updatedUser,notification:s.notification};throw new Error("Erreur lors de la mise à jour de l'utilisateur")}catch(o){return d(o,t),{success:!1,user:null,notification:"Une erreur est survenue"}}}export{g as R,c as a,b,w as c,T as d,D as e,M as f,i as g,y as h,S as l,O as s,U as u,L as v};
